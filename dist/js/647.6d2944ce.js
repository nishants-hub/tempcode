"use strict";(self.webpackChunkconstruction_commercial_search_frontend=self.webpackChunkconstruction_commercial_search_frontend||[]).push([[647],{80647:function(e,a,t){t.r(a),t.d(a,{default:function(){return l}});var n=(t(44114),t(77788)),o=t(78626),i=t(93518),s={components:{FormInput:()=>t.e(6342).then(t.bind(t,96342)),IconX:()=>t.e(6847).then(t.bind(t,96847)),IconInfo:()=>t.e(9794).then(t.bind(t,29794)),GeneralButton:()=>t.e(695).then(t.bind(t,90695)),GeneralForm:()=>t.e(6277).then(t.bind(t,76277)),LocationSearchDropdown:()=>t.e(9007).then(t.bind(t,29007)),ProductSearchDropdown:()=>t.e(8118).then(t.bind(t,98118))},computed:{...(0,i.L8)({user:"auth/getUser"}),buildPayload(){let e={companyName:this.formData?.companyName,genNumber:this.formData?.genNumber,commNumber:this.formData?.commNumber,email:this.formData?.email,location:this.formData?.location?.display_name||"",lat:this.formData?.location?.lat||"",long:this.formData?.location?.lon||"",origin:this.formData?.origin,originList:this.formData?.originList,annualRevenue:this.formData?.annualRevenue,agents:this.formData?.agents,products:this.formData?.products?.map((e=>({productId:e?._id})))};return this.update||(e.addUser=this.user?._id),e},areSomeFieldsMissing(){let e=!1,a=this.buildPayload;return a?.companyName&&a?.genNumber&&a?.commNumber&&a?.email&&a?.location&&a?.lat&&a?.long&&a?.origin&&a?.originList&&!isNaN(a?.annualRevenue)&&0!==a?.agents?.length&&0!==a?.products?.length&&!a?.agents?.some((e=>!e.genNumber||!e.commNumber||!e.email))||(e=!0),e},customButtonsAnalyze(){let e=[];return e=this.addedToMainDB?[{label:"CONFIRM",payload:"COMPANY_DETAILS_SUCCESSFULLY_ADDED",type:"success",isDisabled:!1,emphasis:"primary"},{label:"NIR",payload:"NO_INTERNET_REFRENCE",type:"brand-secondary",isDisabled:!1,emphasis:"primary"},{label:"NPI",payload:"NO_PRODUCT_OF_INTEREST",type:"brand",isDisabled:!1,emphasis:"primary"}]:[{label:"ADD",payload:"COMPANY_SUCCESSFULLY_ADDED",type:"success",isDisabled:!1,emphasis:"primary"},{label:"NIR",payload:"NO_INTERNET_REFRENCE",type:"brand-secondary",isDisabled:!1,emphasis:"primary"},{label:"NPI",payload:"NO_PRODUCT_OF_INTEREST",type:"brand",isDisabled:!1,emphasis:"primary"}],e}},mounted(){this.$bus.$on("set-company-location",(e=>{e&&(this.formData.location=e)})),this.$bus.$on("company-form-update",(e=>{if(e?.update)this.companyId=e?.companyId,this.analyze=e?.analyze??!1,this.update=e?.update,this.addedToMainDB=e?.addedToMainDB||!1,this.formData=e?.formData,e?.formData?.companyName&&(this.whiteListCompanyName=e?.formData?.companyName||""),this.goBack=e?.goBack||!1;else if(this.update=!1,this.companyId=null,e?.default&&e?.formData){for(const a in e.formData)this.formData[a]=e.formData[a];e?.refreshFlowEvent&&(this.refreshFlowEvent=e?.refreshFlowEvent)}}))},data(){return{customButtons:[{label:"Add details later",payload:"ADD_LATER",type:"brand-secondary",isDisabled:!1,emphasis:"primary"},{label:"Data not available",payload:"DATA_NOT_AVAILABLE",type:"brand",isDisabled:!1,emphasis:"primary"}],refreshFlowEvent:null,companyId:null,analyze:!1,formData:{companyName:"",genNumber:"",commNumber:"",email:"",annualRevenue:"",origin:"MANUAL_SINGLE_ADD",originList:"",location:null,products:[],agents:[]},fieldValidations:{companyName:new n.s({minLength:5,maxLength:50,required:!0}),genNumber:new n.s({minLength:19,maxLength:19,required:!1,type:"PHONE_NUMBER"}),commNumber:new n.s({minLength:19,maxLength:19,required:!1,type:"PHONE_NUMBER"}),email:new n.s({type:"EMAIL",required:!1}),annualRevenue:new n.s({min:0}),agents:{genNumber:new n.s({minLength:19,maxLength:19,required:!1,type:"PHONE_NUMBER"}),commNumber:new n.s({minLength:19,maxLength:19,required:!1,type:"PHONE_NUMBER"}),email:new n.s({type:"EMAIL",required:!0})}},update:!1,isFormSubmitting:!1,goBack:!1,addedToMainDB:!1,checkingCompanyName:!1,isCompanyNameAvailable:!0,whiteListCompanyName:"",checkForCompanyDebounced:(0,o.debounce)(this.checkForCompany,500),companyNameSuggestions:[]}},watch:{"formData.companyName":{handler(e){this.checkForCompanyDebounced(e)},immediate:!0,deep:!0}},methods:{...(0,i.i0)({addCompanies:"company/addCompanies",updateCompany:"company/updateCompany",checkCompanyNameAvailabilty:"company/checkCompanyNameAvailabilty"}),async checkForCompany(e){if(""===e||e?.toLowerCase()?.trim()===this.whiteListCompanyName?.toLowerCase()?.trim())return void(this.isCompanyNameAvailable=!0);this.checkingCompanyName=!0;const a=await this.checkCompanyNameAvailabilty({params:{companyName:e,fetchRelated:!0}});a?.success?(this.isCompanyNameAvailable=!0,this.companyNameSuggestions=a?.suggestions):(this.isCompanyNameAvailable=!1,this.companyNameSuggestions=a?.suggestions||[]),this.checkingCompanyName=!1},async handleSubmit(e){if(!this.$validateForm())return;let a=this.buildPayload;if(e&&(this.analyze?a.archiveReason=e:a.dataMissing=e),this.isFormSubmitting=!0,this.update){const e=await this.updateCompany({id:this.companyId,body:a});e?.success?(this.$bus.$emit("refetch-company-details"),this.analyze?this.$bus.$emit("refetch-bulk-added-companies"):this.$bus.$emit("refetch-archived-companies"),this.handleClose()):this.$toast.error(e?.message)}else{const e=await this.addCompanies(a);e?.success?(this.refreshFlowEvent?this.$bus.$emit(this.refreshFlowEvent):this.$bus.$emit("refetch-companies"),this.handleClose()):this.$toast.error(e?.message)}this.isFormSubmitting=!1},addAgent(){this.formData.agents.push({genNumber:"",commNumber:"",email:""})},removeAgent(e){this.formData.agents.splice(e,1)},handleClose(){this.$bus.$emit("add-new-company-modal",{showModal:!1}),this.goBack&&this.$router.go(-1)},updateLocation(e){this.formData.location=e},updateProducts(e){this.formData.products=e},selectLocationOnMap(){this.$bus.$emit("company-map-modal",{showModal:!0,selectLocation:!0,selectedLocationCoords:this.formData.location})}},beforeDestroy(){this.$bus.$off("set-company-location"),this.$bus.$off("company-form-update")}},r=s,m=(0,t(81656).A)(r,(function(){var e=this,a=e._self._c;return a("div",{staticClass:"h-full w-full"},[a("GeneralForm",{attrs:{heading:e.update?e.analyze?"Analyze":"Edit Details":"New Company",showCloseButton:!0,"is-form-submitting":e.isFormSubmitting,"submit-button-label":e.update?e.analyze?"Done":"Update":"Add","show-submit-button-force":!0,"submit-button-type":e.update?e.analyze?"brand-secondary":"brand":"success","custom-buttons":e.analyze?e.customButtonsAnalyze:e.customButtons,"show-custom-buttons":e.areSomeFieldsMissing},on:{"close-pressed":e.handleClose,"form-submitted":e.handleSubmit},scopedSlots:e._u([{key:"form-body",fn:function(){return[e.addedToMainDB?a("div",{staticClass:"mb-spacing-300 flex items-center gap-spacing-100 rounded-08 border border-stroke-info bg-bg-status-info px-spacing-200 py-spacing-100"},[a("IconInfo",{staticClass:"h-spacing-200 w-spacing-200 text-content-on-status-on-info"}),a("p",{staticClass:"text-body/m/relaxed/400 text-content-on-status-on-info"},[e._v(" This company already added in the main database. ")])],1):e._e(),a("div",{staticClass:"relative"},[a("FormInput",{ref:"companyName",staticClass:"mb-spacing-100",attrs:{autofocus:!0,label:"Company Name",inputId:"companyName","field-validations":e.fieldValidations?.companyName,order:1,"check-availability":!0,"checking-availability":e.checkingCompanyName,"is-available":e.isCompanyNameAvailable,"not-available-error-message":"Company already exists"},on:{"enter-pressed":function(a){return e.$focusNextElement("genNumber")},blur:function(a){e.companyNameSuggestions=[]},focus:function(a){return e.checkForCompanyDebounced(e.formData.companyName)}},model:{value:e.formData.companyName,callback:function(a){e.$set(e.formData,"companyName",a)},expression:"formData.companyName"}}),e.companyNameSuggestions?.length||e.checkingCompanyName?a("div",{staticClass:"absolute left-spacing-0 right-spacing-0 top-[44px] z-[101] mt-spacing-25 max-h-[250px] w-full overflow-y-auto rounded-08 bg-bg-neutral-default shadow-card"},e._l(e.companyNameSuggestions,(function(t,n){return a("div",{key:n,staticClass:"flex cursor-not-allowed items-center justify-between border-b border-stroke-bold bg-bg-neutral-raised px-spacing-150 py-spacing-150"},[a("p",{staticClass:"text-body/m/relaxed/400 text-content-on-neutral-primary"},[e._v(" "+e._s(t?.display_name)+" ")]),a("i",{staticClass:"fa-solid fa-ban text-content-on-status-on-error"})])})),0):e._e()],1),a("div",{staticClass:"grid grid-cols-1 gap-x-spacing-200 gap-y-spacing-100 ipad:grid-cols-2"},[a("FormInput",{ref:"genNumber",attrs:{label:"General Number","input-type":"phoneNumber",inputId:"genNumber","field-validations":e.fieldValidations?.genNumber,order:2},on:{"enter-pressed":function(a){return e.$focusNextElement("commNumber")}},model:{value:e.formData.genNumber,callback:function(a){e.$set(e.formData,"genNumber",a)},expression:"formData.genNumber"}}),a("FormInput",{ref:"commNumber",attrs:{label:"Commercial Number","input-type":"phoneNumber",inputId:"commNumber","field-validations":e.fieldValidations?.commNumber,order:3},on:{"enter-pressed":function(a){return e.$focusNextElement("email")}},model:{value:e.formData.commNumber,callback:function(a){e.$set(e.formData,"commNumber",a)},expression:"formData.commNumber"}}),a("FormInput",{ref:"companyEmail",attrs:{label:"Email","input-type":"email",inputId:"email","field-validations":e.fieldValidations?.email,order:4},on:{"enter-pressed":function(a){return e.$focusNextElement("origin")}},model:{value:e.formData.email,callback:function(a){e.$set(e.formData,"email",a)},expression:"formData.email"}}),a("FormInput",{attrs:{label:"Origin",inputId:"origin",order:5},on:{"enter-pressed":function(a){return e.$focusNextElement("originList")}},model:{value:e.formData.origin,callback:function(a){e.$set(e.formData,"origin",a)},expression:"formData.origin"}}),a("FormInput",{attrs:{label:"Origin List",inputId:"originList",order:6},on:{"enter-pressed":function(a){return e.$focusNextElement("annualRevenue")}},model:{value:e.formData.originList,callback:function(a){e.$set(e.formData,"originList",a)},expression:"formData.originList"}}),a("FormInput",{ref:"annualRevenue",attrs:{label:"Annual Revenue","input-type":"number",inputId:"annualRevenue","field-validations":e.fieldValidations?.annualRevenue,order:7},on:{"enter-pressed":function(a){return e.$focusNextElement("location")}},model:{value:e.formData.annualRevenue,callback:function(a){e.$set(e.formData,"annualRevenue",a)},expression:"formData.annualRevenue"}})],1),a("div",{staticClass:"my-spacing-100 flex items-center gap-spacing-200"},[a("LocationSearchDropdown",{staticClass:"flex-1",attrs:{"dropdown-label":"Location","dropdown-id":"location","selected-location":e.formData?.location?e.formData?.location:void 0,order:8},on:{"on-location-update":e.updateLocation,"enter-pressed":function(a){return e.$focusNextElement("products")}}}),a("div",{staticClass:"mb-spacing-250 cursor-pointer",on:{click:function(a){return a.stopPropagation(),e.selectLocationOnMap.apply(null,arguments)}}},[a("i",{staticClass:"fa-solid fa-location scale-[1.5] text-constant-brand-secondary hover:text-hover-constant-brand-secondary"})])],1),a("ProductSearchDropdown",{staticClass:"my-spacing-100",attrs:{"dropdown-label":"Products","dropdown-id":"products",products:e.formData.products,"is-multi-select":!0,order:9},on:{"on-products-update":e.updateProducts,"enter-pressed":function(a){return e.$focusNextElement("agentGenNumber0")}}}),a("div",{staticClass:"grid grid-cols-1 gap-x-spacing-200 gap-y-spacing-200 ipad:grid-cols-2"},e._l(e.formData.agents,(function(t,n){return a("div",{key:n,staticClass:"relative flex flex-col gap-spacing-100 rounded-12 border border-stroke-bold p-spacing-150 pt-spacing-300"},[a("p",{staticClass:"absolute -top-[14px] left-spacing-200 origin-0 bg-bg-neutral-default p-spacing-50 text-body/m/relaxed/400 text-content-on-neutral-secondary"},[e._v(" Agent "+e._s(n+1)+" ")]),a("div",{staticClass:"absolute -right-spacing-150 -top-spacing-150 z-10 flex h-spacing-300 w-spacing-300 cursor-pointer items-center justify-center rounded-full bg-bg-neutral-disabled text-content-on-neutral-secondary hover:bg-constant-status-error hover:text-constant-neutral-white",on:{click:function(a){return e.removeAgent(n)}}},[a("IconX",{staticClass:"h-spacing-250 w-spacing-250 text-current"})],1),a("FormInput",{ref:"agentGenNumber",refInFor:!0,attrs:{label:"General Number","input-type":"text",inputId:"agentGenNumber"+n,"field-validations":e.fieldValidations?.agents?.genNumber,order:10+3*n},on:{"enter-pressed":function(a){return e.$focusNextElement("agentCommNumber"+n)}},model:{value:t.genNumber,callback:function(a){e.$set(t,"genNumber",a)},expression:"agent.genNumber"}}),a("FormInput",{ref:"agentCommNumber",refInFor:!0,attrs:{label:"Commercial Number","input-type":"text",inputId:"agentCommNumber"+n,"field-validations":e.fieldValidations?.agents?.commNumber,order:11+3*n},on:{"enter-pressed":function(a){return e.$focusNextElement("agentEmail"+n)}},model:{value:t.commNumber,callback:function(a){e.$set(t,"commNumber",a)},expression:"agent.commNumber"}}),a("FormInput",{ref:"agentEmail",refInFor:!0,attrs:{label:"Email","input-type":"email",inputId:"agentEmail"+n,"field-validations":e.fieldValidations?.agents?.email,order:12+3*n},on:{"enter-pressed":function(a){e.$focusNextElement("agentGenNumber"+(n+1))}},model:{value:t.email,callback:function(a){e.$set(t,"email",a)},expression:"agent.email"}})],1)})),0),a("div",{staticClass:"my-spacing-150 flex w-full"},[a("div",{on:{click:e.addAgent}},[a("GeneralButton",{attrs:{"button-type":"button",type:"brand",size:"small",emphasis:"secondary","icon-position":"none",label:"Add Agent"}})],1)])]},proxy:!0}])})],1)}),[],!1,null,null,null),l=m.exports}}]);