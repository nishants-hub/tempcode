"use strict";(self.webpackChunkconstruction_commercial_search_frontend=self.webpackChunkconstruction_commercial_search_frontend||[]).push([[8519],{8519:function(t,e,a){a.r(e),a.d(e,{default:function(){return n}});var s=(a(44114),a(93518)),o={components:{IconPlus:()=>a.e(531).then(a.bind(a,80531)),PaginatedTable:()=>a.e(9666).then(a.bind(a,19666)),GeneralButton:()=>a.e(695).then(a.bind(a,90695)),AddCompaniesToProductModal:()=>a.e(6691).then(a.bind(a,56691)),IconX:()=>a.e(6847).then(a.bind(a,96847)),DownloadAndView:()=>a.e(1004).then(a.bind(a,71004)),AllQuotationPricesModal:()=>a.e(4028).then(a.bind(a,24028))},props:{bgClass:{type:String,required:!1,default:"bg-bg-neutral-raised"}},async mounted(){this.$bus.$on("fetch-product-details",(t=>{t?.id&&this.fetchData(t?.id)}))},watch:{productData:{handler:function(){this.productData?.companies&&(this.tableData=this.productData?.companies,this.totalPages=Math.ceil(this.tableData?.length/this.itemsPerPage),this.totalCount=this.tableData?.length)},deep:!0}},data:()=>({selectedProductId:null,sortKey:"",sortOrder:"asc",tableData:[],totalPages:1,currentPage:1,itemsPerPage:10,isLoading:!1,totalCount:0}),computed:{...(0,s.aH)({productData:t=>t.category.categoryData?.commercialItem}),headerData(){let t=[{key:"companyName",value:"Company",sortable:!0},{key:"priceQuoted",value:"Price/UNIT",sortable:!0},{key:"price",value:"=Price/UNIT",sortable:!0,description:"Price * Variable coefficient"},{key:"origin",value:"Origin",sortable:!1},{key:"score",value:"SFC",sortable:!0},{key:"GS",value:"GS",sortable:!0},{key:"dateOfPriceAdded",value:"Date",sortable:!0},{key:"quotation",value:"Quotation"}],e=this.productData?.productDetails?.unit;return e&&(t=[{key:"companyName",value:"Company",sortable:!0},{key:"priceQuoted",value:`Price/${e}`,sortable:!0},{key:"price",value:`=Price/${e}`,sortable:!0,description:"Price * Variable coefficient"},{key:"origin",value:"Origin",sortable:!1},{key:"score",value:"SFC",sortable:!0},{key:"GS",value:"GS",sortable:!0},{key:"dateOfPriceAdded",value:"Date",sortable:!0},{key:"quotation",value:"Quotation"}]),t},paginatedAndSortedData(){let t=[...this.tableData];this.sortKey&&t?.sort(((t,e)=>{const a=t[this.sortKey],s=e[this.sortKey];if(null==a&&null==s)return 0;if(null==a)return 1;if(null==s)return-1;const o="number"==typeof a&&"number"==typeof s,i="dateOfPriceAdded"===this.sortKey;if(o)return"asc"===this.sortOrder?a-s:s-a;if(i){const t=new Date(a),e=new Date(s);return"asc"===this.sortOrder?t-e:e-t}return"asc"===this.sortOrder?a?.localeCompare(s):s?.localeCompare(a)}));const e=(this.currentPage-1)*this.itemsPerPage+this.itemsPerPage;return t?.slice(0,e)}},methods:{...(0,s.i0)("category",["getProductDetails"]),async fetchData(t){this.isLoading=!0,await this.getProductDetails({id:t}),this.isLoading=!1},close(){this.$bus.$emit("product-details-table-modal",{showModal:!1}),this.$bus.$emit("set-selected-product",null)},fetchSortedData(t){this.sortKey=t?.sortKey||"",this.sortOrder=t?.sortOrder||""},fetchPage(t,e){this.currentPage=t,e()},handleAddVariables(){this.$bus.$emit("add-new-commercial-item-modal",{showModal:!0,update:!0,type:"PRODUCT",formData:{title:this.productData?.title,unit:this.productData?.productDetails?.unit,productDetails:{variables:this.productData?.productDetails?.variables}},id:this.productData?._id})},addCompanies(){this.$bus.$emit("add-companies-to-product-modal",{showModal:!0,productData:this.productData})},goToCompany(t){this.$router.push(`/dashboard/companies/${t}`)},allPrices(t){this.$bus.$emit("all-quotation-prices-modal",{showModal:!0,data:t})}},beforeDestroy(){this.$bus.$off("fetch-product-details")}},i=o,r=(0,a(81656).A)(i,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"relative flex h-full w-full flex-col"},[e("div",{staticClass:"mb-spacing-100 flex items-center"},[t.productData?.title?e("h2",{staticClass:"px-spacing-200 text-headline/s/relaxed/500 text-constant-brand-primary ipad:px-spacing-300 ipad:text-headline/m/relaxed/500"},[t._v(" "+t._s(t.productData?.title)+" ")]):t._e(),t.productData?.title?e("div",{on:{click:function(e){return t.handleAddVariables()}}},[e("GeneralButton",{attrs:{"button-type":"button",type:"brand",size:"small",emphasis:"secondary","icon-position":"none",label:"Edit"}})],1):t._e(),e("div",{staticClass:"absolute right-spacing-200 top-spacing-0 cursor-pointer",on:{click:function(e){return t.close()}}},[e("IconX",{staticClass:"h-spacing-300 w-spacing-300 text-content-on-neutral-secondary hover:text-content-on-neutral-primary"})],1)]),e("div",{staticClass:"flex flex-col gap-spacing-100 px-spacing-200 nexus:flex-row nexus:items-center ipad:px-spacing-300"},[t.productData?.title?e("div",{staticClass:"flex items-center gap-spacing-100"},[e("p",{staticClass:"text-body/m/relaxed/500 text-content-on-neutral-secondary"},[t._v(" Variables ")]),e("div",{staticClass:"flex h-spacing-200 w-spacing-200 cursor-pointer items-center justify-center rounded-full bg-constant-brand-primary",on:{click:function(e){return t.handleAddVariables()}}},[e("IconPlus",{staticClass:"h-spacing-150 w-spacing-150 text-constant-neutral-white"})],1)]):t._e(),e("p",{staticClass:"text-body/m/relaxed/400 text-content-on-neutral-secondary"},t._l(t.productData?.productDetails?.variables,(function(a,s){return e("span",{key:s,staticClass:"text-body/m/relaxed/400"},[t._v(" "+t._s(s>0?"|":"")+" "+t._s(a?.name)+" ["+t._s(a?.coefficient)+"] ")])})),0)]),e("PaginatedTable",{attrs:{headers:t.headerData,currentPage:t.currentPage,"total-pages":t.totalPages,"sort-key":t.sortKey,"sort-order":t.sortOrder,"total-count":t.totalCount,"bg-class":t.bgClass},on:{"fetch-sorted-data":t.fetchSortedData,"fetch-data":t.fetchPage},scopedSlots:t._u([{key:"table-body",fn:function(){return t._l(t.paginatedAndSortedData,(function(a,s){return e("tr",{key:s,staticClass:"border-b border-stroke-bold text-left text-body/m/relaxed/400 text-content-on-neutral-primary ipad:text-body/l/relaxed/400",class:a?.allQuotations?.length>0?"cursor-pointer":"",on:{click:function(e){e.stopPropagation(),a?.allQuotations?.length>0&&t.allPrices({...a,productName:t.productData?.title})}}},[e("td",{staticClass:"py-spacing-100 pr-spacing-100"},[e("span",{staticClass:"block cursor-pointer text-body/m/relaxed/500 hover:text-constant-brand-primary ipad:text-body/l/relaxed/500",on:{click:function(e){return t.goToCompany(a?._id)}}},[t._v(t._s(a?.companyName))]),e("span",{staticClass:"block text-body/m/relaxed/400 italic text-content-on-neutral-secondary"},a?.quotation?.variableId?[t._v("["+t._s(a?.quotation?.variableId?.name)+", "+t._s(a?.quotation?.variableId?.coefficient)+"]")]:[t._v("[default, 1] ")])]),isNaN(parseFloat(a?.priceQuoted))?e("td",{staticClass:"py-spacing-100 pr-spacing-100 text-body/m/relaxed/500 text-content-on-neutral-secondary ipad:text-body/l/relaxed/500"},[t._v(" Not Available ")]):e("td",{staticClass:"py-spacing-100 pr-spacing-100 text-body/m/relaxed/500 ipad:text-body/l/relaxed/500"},[t._v(" "+t._s(t._f("toCurrency")(a?.priceQuoted))+" ")]),isNaN(parseFloat(a?.price))?e("td",{staticClass:"py-spacing-100 pr-spacing-100 text-body/m/relaxed/500 text-content-on-neutral-secondary ipad:text-body/l/relaxed/500"},[t._v(" Not Available ")]):e("td",{staticClass:"py-spacing-100 pr-spacing-100 text-body/m/relaxed/500 ipad:text-body/l/relaxed/500"},[t._v(" "+t._s(t._f("toCurrency")(a?.price))+" ")]),a?.quotation?.marketResearchId?._id||a?.quotation?.type?e("td",{staticClass:"py-spacing-100 pr-spacing-100 text-body/m/relaxed/500 ipad:text-body/l/relaxed/500"},[t._v(" "+t._s(a?.quotation?.marketResearchId?.name||a?.quotation?.type)+" ")]):e("td",{staticClass:"py-spacing-100 pr-spacing-100 text-body/m/relaxed/500 text-content-on-neutral-secondary ipad:text-body/l/relaxed/500"},[t._v(" Not Available ")]),isNaN(parseFloat(a?.score))?e("td",{staticClass:"py-spacing-100 pr-spacing-100 text-body/m/relaxed/500 text-content-on-neutral-secondary ipad:text-body/l/relaxed/500"},[t._v(" Not Available ")]):e("td",{staticClass:"py-spacing-100 pr-spacing-100 text-body/m/relaxed/500 ipad:text-body/l/relaxed/500"},[t._v(" "+t._s(t._f("toPercentage")(a?.score,!0))+" ")]),e("td",{staticClass:"py-spacing-100 pr-spacing-100 text-body/m/relaxed/500 ipad:text-body/l/relaxed/500"},[t._v(" "+t._s(a?.GS)+" ")]),a?.quotation?.dateOfPriceAdded?e("td",{staticClass:"py-spacing-100 pr-spacing-100 text-body/m/relaxed/500 ipad:text-body/l/relaxed/500"},[t._v(" "+t._s(t._f("toDate")(a?.quotation?.dateOfPriceAdded))+" ")]):e("td",{staticClass:"py-spacing-100 pr-spacing-100 text-body/m/relaxed/500 text-content-on-neutral-secondary ipad:text-body/l/relaxed/500"},[t._v(" Not Available ")]),a?.quotation?.quotationFile?e("td",{staticClass:"py-spacing-100 pr-spacing-100 text-body/m/relaxed/500 ipad:text-body/l/relaxed/500"},[e("DownloadAndView",{attrs:{file:a?.quotation?.quotationFile}})],1):e("td",{staticClass:"py-spacing-100 pr-spacing-100 text-body/m/relaxed/500 text-content-on-neutral-secondary ipad:text-body/l/relaxed/500"},[t._v(" Not Available ")])])}))},proxy:!0}])}),t.productData?.title?e("div",{staticClass:"my-spacing-200 ml-spacing-200",on:{click:function(e){return t.addCompanies()}}},[e("GeneralButton",{attrs:{"button-type":"button",type:"brand",size:"small",emphasis:"secondary","icon-position":"none",label:"Add Companies"}})],1):t._e(),e("AddCompaniesToProductModal"),e("AllQuotationPricesModal")],1)}),[],!1,null,null,null),n=r.exports}}]);