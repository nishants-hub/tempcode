"use strict";(self.webpackChunkconstruction_commercial_search_frontend=self.webpackChunkconstruction_commercial_search_frontend||[]).push([[5960],{73579:function(e,t,a){a.r(t),a.d(t,{default:function(){return o}});var i=(a(44114),a(17642),a(58004),a(33853),a(45876),a(32475),a(15024),a(31698),a(77788)),s=a(93518),l={components:{FormInput:()=>a.e(6342).then(a.bind(a,96342)),GeneralForm:()=>a.e(6277).then(a.bind(a,76277)),RadioButton:()=>a.e(8251).then(a.bind(a,28251)),GeneralButton:()=>a.e(695).then(a.bind(a,90695)),UnitSearchDropDown:()=>a.e(1919).then(a.bind(a,81919)),IconX:()=>a.e(6847).then(a.bind(a,96847))},data:()=>({selectedCommercialItem:{key:"Category",value:"CATEGORY"},id:null,update:!1,parent:null,loading:!1,commercialItemOptions:[{key:"Category",value:"CATEGORY"},{key:"Product",value:"PRODUCT"}],formData:{title:"",productDetails:{unit:"",variables:[]}},fieldValidations:{title:new i.s({required:!0,minLength:3}),productDetails:{variables:{name:new i.s({required:!0,minLength:2}),coefficient:new i.s({required:!0,min:0,max:1})},unit:new i.s({minLength:1,maxLength:10,required:!0})}}}),mounted(){this.$bus.$on("category-form-update",(e=>{this.updateForm(e)})),this.$focusNextElement("title")},methods:{...(0,s.i0)({addCommercialItem:"category/addCommercialItem",updateCommercialItem:"category/updateCommercialItem"}),hasUniqueNames(e){const t=new Set;return e.reduce(((e,a)=>!!e&&!t.has(a.name)&&(t.add(a.name),!0)),!0)},updateForm(e){this.parent=e?.parent||null,this.id=e?.id||null,e?.level>=2&&(this.selectedCommercialItem={key:"Product",value:"PRODUCT"}),e?.update&&e?.formData&&(this.update=!0,this.selectedCommercialItem="PRODUCT"===e?.type?{key:"Product",value:"PRODUCT"}:{key:"Category",value:"CATEGORY"},this.formData.title=e?.formData?.title,"PRODUCT"===e?.type&&(this.formData.productDetails.unit=e?.formData?.unit||"",this.formData.productDetails.variables=[...e?.formData?.productDetails?.variables?.map((e=>({...e,isNew:!1})))]))},async handleSubmit(){if(!this.$validateForm())return;if(!this.hasUniqueNames(this.formData?.productDetails?.variables))return this.$toast.error("All variable names must be unique");this.loading=!0;const e=this.buildPayload();if(this.update){const t=await this.updateCommercialItem({id:this.id,body:e});t?.success?(this.$bus.$emit("fetch-product-details",{id:this.id}),this.$bus.$emit("refetch-commercial-items"),this.handleClose()):this.$toast.error(t?.message)}else{const t=await this.addCommercialItem(e);t?.success?(this.$bus.$emit("refetch-commercial-items"),this.handleClose()):this.$toast.error(t?.message)}this.loading=!1},buildPayload(){const{title:e,productDetails:t}=this.formData,a=this.update?{title:e}:{title:e,parentId:this.parent?._id};return"PRODUCT"===this.selectedCommercialItem.value?{...a,type:"product",productDetails:{unit:t?.unit,variables:t?.variables}}:{...a,type:"category"}},removeVariable(e){this.formData.productDetails.variables.splice(e,1)},handleClose(){this.$bus.$emit("add-new-commercial-item-modal",{showModal:!1})},handleFieldChange(e){this.selectedCommercialItem=e,this.resetFields(),this.$focusNextElement("title")},resetFields(){this.formData={title:"",productDetails:{variables:[],variable:{name:"",coefficient:""}}}},addVariable(){this.formData.productDetails.variables.push({name:"",coefficient:"",isNew:!0})},removeVariableFromVariables(e){let t=this.formData?.productDetails?.variables?.filter((t=>t?.name!==e?.name));this.formData.productDetails.variables=t},updateUnit(e){this.formData.productDetails.unit=e?.display_name}},beforeDestroy(){this.$bus.$off("category-form-update")}},r=l,n=(0,a(81656).A)(r,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"flex h-full min-h-[500px] w-full flex-col"},[t("GeneralForm",{staticClass:"flex-1",attrs:{heading:e.update?e.formData?.title:`New ${e.selectedCommercialItem?.key}`,"sub-heading":e.parent?.title||"",showCloseButton:!0,"submit-button-label":e.update?"Update":"Add","submit-button-type":e.update?"brand":"success","is-form-submitting":e.loading},on:{"close-pressed":e.handleClose,"form-submitted":e.handleSubmit},scopedSlots:e._u([{key:"form-body",fn:function(){return[t("div",{staticClass:"flex flex-1 flex-col gap-spacing-100"},[e.update?e._e():t("div",{staticClass:"mb-spacing-250 flex items-center gap-spacing-200"},e._l(e.commercialItemOptions,(function(a,i){return t("div",{key:i,staticClass:"flex cursor-pointer flex-row gap-spacing-100",on:{click:function(t){return e.handleFieldChange(a)}}},[t("RadioButton",{attrs:{selected:e.selectedCommercialItem?.value===a?.value,isEditable:!0}}),t("p",{staticClass:"text-body/m/relaxed/400 text-content-on-neutral-primary"},[e._v(" "+e._s(a?.key)+" ")])],1)})),0),t("div",{class:"PRODUCT"===e.selectedCommercialItem?.value?"mb-spacing-100 grid grid-cols-1 gap-x-spacing-200 gap-y-spacing-100 ipad:grid-cols-2":""},[t("FormInput",{ref:"titleInput",attrs:{label:`${e.selectedCommercialItem?.key} Title`,inputId:"title",autofocus:"",fieldValidations:e.fieldValidations?.title,order:1},on:{"enter-pressed":function(t){"PRODUCT"===e.selectedCommercialItem?.value?e.$focusNextElement("unit"):e.handleSubmit()}},model:{value:e.formData.title,callback:function(t){e.$set(e.formData,"title",t)},expression:"formData.title"}}),"PRODUCT"===e.selectedCommercialItem?.value?t("UnitSearchDropDown",{ref:"unit",attrs:{"dropdown-label":"Unit","dropdown-id":"unit","selected-unit":{display_name:e.formData?.productDetails?.unit},"is-multi-select":!1,"field-validations":e.fieldValidations?.productDetails?.unit,order:2},on:{"on-unit-update":e.updateUnit,"enter-pressed":function(t){e.formData?.productDetails?.variables?.length&&e.$focusNextElement("variable-name-0")}}}):e._e()],1),"PRODUCT"===e.selectedCommercialItem?.value&&e.formData?.productDetails?.variables?.length>0?t("div",{staticClass:"grid grid-cols-1 gap-x-spacing-200 gap-y-spacing-300 ipad:grid-cols-2"},e._l(e.formData?.productDetails?.variables,(function(a,i){return t("div",{key:i,staticClass:"relative flex flex-col gap-spacing-100 rounded-12 border border-stroke-bold p-spacing-150 pt-spacing-300"},[t("p",{staticClass:"absolute -top-[14px] left-spacing-200 origin-0 bg-bg-neutral-default p-spacing-50 text-body/m/relaxed/400 text-content-on-neutral-secondary"},[e._v(" Variable ")]),a?.isNew?t("div",{staticClass:"absolute -right-spacing-150 -top-spacing-150 z-10 flex h-spacing-300 w-spacing-300 cursor-pointer items-center justify-center rounded-full bg-bg-neutral-disabled text-content-on-neutral-secondary hover:bg-constant-status-error hover:text-constant-neutral-white",on:{click:function(t){return e.removeVariable(i)}}},[t("IconX",{staticClass:"h-spacing-250 w-spacing-250 text-current"})],1):e._e(),t("FormInput",{ref:"variableName",refInFor:!0,attrs:{label:"Name",inputId:`variable-name-${i}`,fieldValidations:e.fieldValidations?.productDetails?.variables?.name,order:3+2*i},on:{"enter-pressed":function(t){return e.$focusNextElement(`variable-coefficient-${i}`)}},model:{value:a.name,callback:function(t){e.$set(a,"name",t)},expression:"variable.name"}}),t("FormInput",{ref:"variableCoefficient",refInFor:!0,attrs:{label:"Coefficient","input-type":"number",inputId:`variable-coefficient-${i}`,fieldValidations:e.fieldValidations?.productDetails?.variables?.coefficient,order:4+2*i},on:{"enter-pressed":function(t){return e.$focusNextElement(`variable-name-${i+1}`)}},model:{value:a.coefficient,callback:function(t){e.$set(a,"coefficient",t)},expression:"variable.coefficient"}})],1)})),0):e._e(),"PRODUCT"===e.selectedCommercialItem?.value?t("div",{staticClass:"my-spacing-150 flex"},[t("div",{on:{click:e.addVariable}},[t("GeneralButton",{attrs:{"button-type":"button",type:"brand",size:"small",emphasis:"secondary","icon-position":"none",label:"Add Variable"}})],1)]):e._e()])]},proxy:!0}])})],1)}),[],!1,null,null,null),o=n.exports}}]);