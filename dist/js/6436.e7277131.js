"use strict";(self.webpackChunkconstruction_commercial_search_frontend=self.webpackChunkconstruction_commercial_search_frontend||[]).push([[6436],{16436:function(e,t,i){i.r(t),i.d(t,{default:function(){return d}});var s=(i(64979),i(71678),i(93518)),a=i(61527),n={name:"TreeView",components:{draggable:i.n(a)(),IconPlus:()=>i.e(531).then(i.bind(i,80531)),IconTrash2:()=>i.e(4956).then(i.bind(i,14956)),IconEdit3:()=>i.e(807).then(i.bind(i,70807)),GeneralSkeleton:()=>i.e(2174).then(i.bind(i,2174))},props:{nodeObj:{type:Object,required:!0},level:{type:Number,default:0},index:{type:Number,required:!0},parentNumbering:{type:String},selectedProduct:{type:Object},expandedTreeView:{type:Object,default:()=>({expand:!1})},searchItemName:{type:String,default:""}},data(){return{isExpanded:this.expandedTreeView?.expand,isLoading:!1,isDragging:!1,canDrag:!0,node:this.nodeObj,showActions:!1,tooltipTimeout:null,clonedData:null}},mounted(){this.deleteHandler=async({id:e,optionSelected:t})=>{if(this.node?._id===e){this.$bus.$emit("showLoader",{showLoader:!0});let i={id:e,params:{deleteType:t?"this":"all"}};const s=await this.deleteCommercialItem(i);s?.success?(this.$toast.success(s?.message),this.$bus.$emit("showLoader",!1),this.$bus.$emit("refetch-commercial-items")):(this.$bus.$emit("showLoader",!1),this.$toast.error(s?.message))}},this.$bus.$on("delete-commercial-item",this.deleteHandler)},computed:{getNumbering(){return this.parentNumbering?`${this.parentNumbering}${this.index+1}.`:this.index+1+"."},isProduct(){return"product"===this.node?.type},isCategory(){return"category"===this.node?.type},isProductSelected(){return this.selectedProduct?._id===this.node?._id},categoryHasChild(){return this.isCategory&&this.node?.commercialItems?.length>0}},watch:{nodeObj:{handler(){this.node=this.nodeObj},deep:!0,immediate:!0},expandedTreeView:{handler(e){this.isExpanded=e?.expand},deep:!0,immediate:!0},isExpanded:{handler(){this.categoryHasChild||this.isProduct||(this.isExpanded=!0)},immediate:!0}},methods:{...(0,s.i0)("category",["reorderCommercialItems","deleteCommercialItem"]),handleRightClick(){this.showToolTip()},showToolTip(){this.showActions=!0,this.startTimer()},hideToolTip(){this.showActions=!1},startTimer(){this.resetTimer(),this.tooltipTimeout=setTimeout((()=>{this.hideToolTip(),this.resetTimer()}),1500)},resetTimer(){this.tooltipTimeout&&(clearTimeout(this.tooltipTimeout),this.tooltipTimeout=null)},async toggle(){this.isExpanded=!this.isExpanded},addChild(){this.$bus.$emit("add-new-commercial-item-modal",{showModal:!0,parent:this.node,level:this.level})},handleNodeClick(){this.isProduct?this.$bus.$emit("set-selected-product",this.node):this.node.commercialItems?.length>0&&this.toggle()},onDragStart(){this.clonedData=structuredClone(this.node),this.$bus.$emit("handle-commercial-items-state",{type:"CLONE"}),this.isDragging=!0},onDragEnd(e){this.isDragging=!1,e?.from?.id===e?.to?.id&&e.oldIndex===e.newIndex||this.reorderChildNodes(e?.from?.id,e?.to?.id,e?.oldIndex,e?.newIndex)},async reorderChildNodes(e,t,i,s){this.canDrag=!1,this.$bus.$emit("showLoader",{showLoader:!0});const a=await this.reorderCommercialItems({body:{from:e,to:t,oldIndex:i,newIndex:s,itemId:this.clonedData?.commercialItems?.[i]?._id}});a?.success?(this.$toast.success(a?.message),this.$bus.$emit("showLoader",!1),this.$bus.$emit("refetch-commercial-items")):(this.$bus.$emit("showLoader",!1),this.$toast.error(a?.message),this.$bus.$emit("handle-commercial-items-state",{type:"RESTORE"})),this.clonedData=null,this.canDrag=!0},removeCommercialItem(){this.isCategory?this.$bus.$emit("remove-confirmation-modal",{showModal:!0,checkboxDescription:this.categoryHasChild?"Move contents to the parent category before deletion?":"",confirmationText:`This category (${this.node?.title}) and all of its associated data, product prices and market-researches will be deleted pemanently.`,confirmEvent:"delete-commercial-item",id:this.node?._id}):this.$bus.$emit("remove-confirmation-modal",{showModal:!0,confirmationText:`This product (${this.node?.title}) and all of its associated data, prices and market-researches will be deleted pemanently.`,confirmEvent:"delete-commercial-item",id:this.node?._id})},handleEditCommercialItem(){this.isCategory&&this.$bus.$emit("add-new-commercial-item-modal",{showModal:!0,update:!0,type:"CATEGORY",formData:{title:this.node?.title},id:this.node?._id})}},beforeDestroy(){this.resetTimer(),this.$bus.$off("delete-commercial-item",this.deleteHandler)}},o=n,r=(0,i(81656).A)(o,(function(){var e=this,t=e._self._c;return t("div",{class:e.level>0?"pl-spacing-300":""},[t("div",{staticClass:"relative"},[t("div",{staticClass:"truncate py-spacing-50 text-[0.9375rem] text-body/m/relaxed/400",class:[e.isProductSelected?"text-constant-brand-primary":"text-content-on-neutral-primary"]},[t("span",{class:e.categoryHasChild||e.isProduct?"cursor-pointer":"",on:{click:e.handleNodeClick,contextmenu:function(t){return t.preventDefault(),e.handleRightClick.apply(null,arguments)}}},[e.categoryHasChild?t("span",{staticClass:"mr-spacing-50 inline-block cursor-pointer"},[e.isExpanded?t("i",{staticClass:"fa-solid fa-caret-down h-spacing-200 w-spacing-200 text-content-on-neutral-secondary"}):t("i",{staticClass:"fa-solid fa-caret-right h-spacing-200 w-spacing-200 text-content-on-neutral-secondary"})]):t("span",{staticClass:"mr-spacing-50 inline-block h-spacing-200 w-spacing-200"}),t("span",{staticClass:"mr-spacing-100 text-body/s/relaxed/500 text-content-on-neutral-tertiary"},[e._v(e._s(e.getNumbering))]),e.isProduct?t("i",{staticClass:"fa-brands fa-pinterest scale-[1.2] rounded-full bg-constant-neutral-white text-[0.9375rem] text-constant-status-error"}):e.isCategory&&e.isExpanded?t("i",{staticClass:"fa fa-folder-open text-[0.9375rem] text-yellow-500 dark:text-yellow-200"}):e.isCategory&&!e.isExpanded?t("i",{staticClass:"fa fa-folder text-[0.9375rem] text-yellow-500 dark:text-yellow-200"}):e._e()]),t("span",{staticClass:"pl-spacing-100",class:e.categoryHasChild||e.isProduct?"cursor-pointer":"",attrs:{title:e.node?.title},domProps:{innerHTML:e._s(e.$highlightMatch(e.node?.title,e.searchItemName))},on:{click:e.handleNodeClick,contextmenu:function(t){return t.preventDefault(),e.handleRightClick.apply(null,arguments)}}}),e.isCategory?t("IconPlus",{staticClass:"ml-spacing-100 inline-block h-spacing-200 w-spacing-200 cursor-pointer text-content-on-neutral-primary hover:text-constant-status-success",nativeOn:{click:function(t){return t.stopPropagation(),e.addChild.apply(null,arguments)}}}):e._e()],1),t("transition",{attrs:{name:"fade"}},[t("div",{directives:[{name:"show",rawName:"v-show",value:e.showActions,expression:"showActions"}],staticClass:"absolute bottom-spacing-400 left-spacing-500 flex min-w-spacing-1400 items-center justify-center gap-spacing-200 rounded-full bg-bg-neutral-raised px-spacing-200 py-spacing-150",on:{mouseover:e.resetTimer,mouseleave:e.startTimer}},[t("div",{staticClass:"absolute -bottom-spacing-100 left-spacing-600 h-0 w-0 rotate-180 border-b-8 border-l-8 border-r-8 border-transparent border-b-bg-neutral-raised"}),e.isCategory?t("IconPlus",{staticClass:"h-spacing-200 w-spacing-200 cursor-pointer text-content-on-neutral-primary hover:text-constant-status-success",nativeOn:{click:function(t){return t.stopPropagation(),e.addChild.apply(null,arguments)}}}):e._e(),e.isCategory?t("IconEdit3",{staticClass:"h-spacing-200 w-spacing-200 cursor-pointer text-content-on-neutral-secondary hover:text-constant-status-warning",nativeOn:{click:function(t){return t.stopPropagation(),e.handleEditCommercialItem.apply(null,arguments)}}}):e._e(),t("IconTrash2",{staticClass:"h-spacing-200 w-spacing-200 cursor-pointer text-content-on-neutral-secondary hover:text-constant-status-error",nativeOn:{click:function(t){return t.stopPropagation(),e.removeCommercialItem.apply(null,arguments)}}})],1)])],1),e.isCategory?t("div",[t("div",{directives:[{name:"show",rawName:"v-show",value:e.isExpanded&&e.isLoading,expression:"isExpanded && isLoading"}],staticClass:"my-spacing-50 flex flex-col gap-spacing-50"},e._l([1,2],(function(e){return t("GeneralSkeleton",{key:e,staticClass:"ml-spacing-300 h-spacing-250 w-spacing-1600"})})),1),t("div",{directives:[{name:"show",rawName:"v-show",value:e.isExpanded&&!e.isLoading,expression:"isExpanded && !isLoading"}]},[t("draggable",{attrs:{disabled:!e.canDrag,"ghost-class":"opacity-40",id:e.node?._id,group:"tree"},on:{start:e.onDragStart,end:e.onDragEnd},model:{value:e.node.commercialItems,callback:function(t){e.$set(e.node,"commercialItems",t)},expression:"node.commercialItems"}},e._l(e.node?.commercialItems,(function(i,s){return t("div",{key:i?._id},[t("TreeView",{class:[1===e.level&&s===e.node?.commercialItems?.length-1?"mb-spacing-100":"mb-spacing-50"],attrs:{"node-obj":i,level:Number(e.level+1),index:s,"parent-numbering":e.getNumbering,"selected-product":e.selectedProduct,"expanded-tree-view":e.expandedTreeView,"search-item-name":e.searchItemName}})],1)})),0)],1)]):e._e()])}),[],!1,null,null,null),d=r.exports}}]);