"use strict";(self.webpackChunkconstruction_commercial_search_frontend=self.webpackChunkconstruction_commercial_search_frontend||[]).push([[5827],{45827:function(e,t,a){a.r(t),a.d(t,{default:function(){return p}});var s=(a(44114),a(77788)),i=a(93518),r=a(78275),n=a(49659),l={components:{FormInput:()=>a.e(6342).then(a.bind(a,96342)),GeneralForm:()=>a.e(6277).then(a.bind(a,76277)),GeneralSelect:()=>a.e(5933).then(a.bind(a,95933)),UserSearchDropDown:()=>a.e(1459).then(a.bind(a,91459)),ProductSearchDropdown:()=>a.e(8118).then(a.bind(a,98118)),GeneralTextEditor:()=>a.e(2443).then(a.bind(a,12443)),GeneralFileUpload:()=>a.e(7259).then(a.bind(a,37259)),ClassicTable:()=>a.e(440).then(a.bind(a,30440)),FileActions:()=>a.e(9667).then(a.bind(a,99667))},mounted(){this.$bus.$on("update-market-research-form",(e=>{e?.update&&(this.update=e?.update,e?.marketResearchData&&(this.id=e?.marketResearchData?._id,this.formData.name=e?.marketResearchData?.name||"",this.formData.note=e?.marketResearchData?.note||"",this.formData.dateStart=new Date(e?.marketResearchData?.dateStart).toISOString()?.substring(0,10)||(0,r.wZ)(0),this.formData.leadRepresentative={display_name:e?.marketResearchData?.leadRepresentative?.name,_id:e?.marketResearchData?.leadRepresentative?._id},this.formData.group=e?.marketResearchData?.group?.map((e=>({display_name:e?.name,_id:e?._id}))),this.formData.products=e?.marketResearchData?.products?.map((e=>({display_name:e?.title,originalTitle:e?.title,_id:e?._id}))),this.formData.tag=e?.marketResearchData?.tag,e?.marketResearchData?.settings&&(this.formData.settings=e?.marketResearchData?.settings),this.formData.emailTemplate=e?.marketResearchData?.emailTemplate,this.formData.guidelines=e?.marketResearchData?.guidelines,this.formData.relatedFiles=e?.marketResearchData?.relatedFiles?.map((e=>({isLink:!0,link:e,name:e?.split("/")?.pop()})))))}))},data:()=>({fileHeaders:[{key:"fileName",value:"File Name",sortable:!1},{key:"action",value:"Action",sortable:!1}],tagSelectOptions:[{key:"STARTING_SOON",value:"starting soon",default:!0},{key:"IN_PROGRESS",value:"in progress"},{key:"PENDING_APPROVAL",value:"pending approval"},{key:"COMPLETED",value:"completed"}],id:null,isFormSubmitting:!1,formData:{tag:"STARTING_SOON",name:"",leadRepresentative:null,group:[],products:[],dateStart:(0,r.wZ)(0),note:"",settings:{weekendsSchedulingAllowed:"NO",followUpDateInterval:3},emailTemplate:"",guidelines:"",relatedFiles:[]},fieldValidations:{name:new s.s({required:!0,minLength:5,maxLength:100}),followUpDateInterval:new s.s({required:!1,min:0,max:60}),note:new s.s({required:!1,minLength:5,maxLength:200})},schedulingOptions:[{key:"YES",value:"Yes"},{key:"NO",value:"No",default:!0}],update:!1,deletedFiles:[]}),computed:{acceptedFileTypes:()=>n.Z?.MARKET_RESEARCH_FILES?.ALLOWED_FILE_EXTENSIONS},methods:{...(0,i.i0)({addMarketResearch:"marketResearch/addMarketResearch",updateMarketResearch:"marketResearch/updateMarketResearch"}),handleGuideLinesChange(e){this.formData.guidelines=e},handleEmailTemplateChange(e){this.formData.emailTemplate=e},async handleSubmit(){if(!this.$validateForm())return;let e=this.buildPayload();this.isFormSubmitting=!0;const t=this.update?await this.updateMarketResearch(e):await this.addMarketResearch(e);t?.success?(this.update?this.$bus.$emit("refetch-market-research-details"):this.$bus.$emit("refetch-market-researches"),this.handleClose()):this.$toast.error(t?.message||"An Error Occurred"),this.isFormSubmitting=!1},buildPayload(){const e=new FormData;return e.append("name",this.formData.name||""),e.append("dateStart",this.formData.dateStart||""),e.append("tag",this.formData.tag||""),e.append("products",JSON.stringify(this.formData.products?.map((e=>e?._id))||[])),e.append("group",JSON.stringify(this.formData.group?.filter((e=>e?._id!==this.formData?.leadRepresentative?._id))?.map((e=>e?._id))||[])),e.append("leadRepresentative",this.formData?.leadRepresentative?._id||""),e.append("note",this.formData.note||""),e.append("settings",JSON.stringify(this.formData.settings||{})),e.append("guidelines",this.formData.guidelines||""),e.append("emailTemplate",this.formData.emailTemplate||""),this.update&&e.append("deletedFiles",JSON.stringify(this.deletedFiles)),this.formData.relatedFiles.forEach(((t,a)=>{t?.isLink||e.append(`files[${a}]`,t)})),this.update?{id:this.id,body:e}:e},handleClose(){this.$bus.$emit("add-new-market-research-modal",!1)},handleSelectedTag(e){this.formData.tag=e},handleSelectedSchedulingOption(e){this.formData.settings.weekendsSchedulingAllowed=e},handleGroupUpdate(e){this.formData.group=e},handleUserUpdate(e){this.formData.leadRepresentative=e},updateProducts(e){this.formData.products=e},processFiles(e){e?.forEach((e=>{this.formData.relatedFiles.unshift(e)}))},removeFile(e){this.formData.relatedFiles[e]?.isLink&&this.deletedFiles.push(this.formData.relatedFiles[e]?.link),this.formData.relatedFiles?.splice(e,1)}},beforeDestroy(){this.$bus.$off("update-market-research-form")}},o=l,d=(0,a(81656).A)(o,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"h-full w-full"},[t("GeneralForm",{attrs:{heading:e.update?e.formData?.name||"EDIT RESEARCH DETAILS":"New Market Research",showCloseButton:!0,"is-form-submitting":e.isFormSubmitting,"submit-button-label":e.update?"Update":"Add"},on:{"close-pressed":e.handleClose,"form-submitted":e.handleSubmit},scopedSlots:e._u([{key:"form-body",fn:function(){return[t("FormInput",{ref:"marketResearchName",staticClass:"mb-spacing-100",attrs:{autofocus:!0,label:"Research Name",inputId:"researchName","field-validations":e.fieldValidations?.name,order:1},on:{"enter-pressed":function(t){return e.$focusNextElement("leadRepresentative")}},model:{value:e.formData.name,callback:function(t){e.$set(e.formData,"name",t)},expression:"formData.name"}}),t("UserSearchDropDown",{staticClass:"mb-spacing-100",attrs:{"dropdown-label":"Lead Representative","dropdown-id":"leadRepresentative","selected-user":e.formData.leadRepresentative},on:{"on-user-update":e.handleUserUpdate}}),t("UserSearchDropDown",{staticClass:"mb-spacing-100",attrs:{"dropdown-label":"Group","dropdown-id":"group",group:e.formData.group,"is-multi-select":!0},on:{"on-group-update":e.handleGroupUpdate}}),t("ProductSearchDropdown",{staticClass:"mb-spacing-100",attrs:{products:e.formData.products,"dropdown-label":"Products","dropdown-id":"products","is-multi-select":!0},on:{"on-products-update":e.updateProducts}}),t("div",{staticClass:"grid grid-cols-1 gap-x-spacing-200 gap-y-spacing-200 ipad:grid-cols-2"},[t("FormInput",{staticClass:"mb-spacing-100",attrs:{label:"Follow Up Date Interval (in days)","input-type":"number",inputId:"followUpDateInterval","field-validations":e.fieldValidations?.followUpDateInterval},on:{"enter-pressed":function(t){return e.$focusNextElement("tag")}},model:{value:e.formData.settings.followUpDateInterval,callback:function(t){e.$set(e.formData.settings,"followUpDateInterval",t)},expression:"formData.settings.followUpDateInterval"}}),t("GeneralSelect",{staticClass:"mb-spacing-100",attrs:{label:"Weekends Scheduling Allowed",options:e.schedulingOptions,"selected-option-key":e.formData.settings?.weekendsSchedulingAllowed},on:{"option-selected":e.handleSelectedSchedulingOption}})],1),t("div",{staticClass:"grid grid-cols-1 gap-x-spacing-200 gap-y-spacing-200 ipad:grid-cols-2"},[t("FormInput",{staticClass:"mb-spacing-100",attrs:{label:"Start Date","input-type":"date",inputId:"dateStart"},on:{"enter-pressed":function(t){return e.$focusNextElement("tag")}},model:{value:e.formData.dateStart,callback:function(t){e.$set(e.formData,"dateStart",t)},expression:"formData.dateStart"}}),t("GeneralSelect",{staticClass:"mb-spacing-100",attrs:{label:"Tag",options:e.tagSelectOptions,"selected-option-key":e.formData.tag},on:{"option-selected":e.handleSelectedTag}})],1),t("FormInput",{ref:"marketResearchNote",staticClass:"mb-spacing-100",attrs:{label:"Note","input-type":"text",inputId:"location",multiline:!0,placeholder:"Type your note...","field-validations":e.fieldValidations?.note,order:2},model:{value:e.formData.note,callback:function(t){e.$set(e.formData,"note",t)},expression:"formData.note"}}),t("GeneralFileUpload",{staticClass:"mb-spacing-300",attrs:{label:"Upload Related Files","accepted-file-types":e.acceptedFileTypes,"allow-multiple":!0,"aria-label":"Upload Research Related Files"},on:{"files-uploaded":e.processFiles}}),e.formData?.relatedFiles?.length>0?t("p",{staticClass:"mb-spacing-100 text-body/l/relaxed/400 text-content-on-neutral-primary"},[e._v(" Uploaded Files: ")]):e._e(),e.formData?.relatedFiles?.length>0?t("ClassicTable",{staticClass:"mb-spacing-300",attrs:{headers:e.fileHeaders,"horizontal-padding":"px-spacing-0",bgClass:"bg-transparent"},scopedSlots:e._u([{key:"table-body",fn:function(){return e._l(e.formData?.relatedFiles,(function(a,s){return t("tr",{key:s,staticClass:"border-b border-stroke-bold text-body/m/relaxed/400 text-content-on-neutral-primary"},[t("td",{staticClass:"py-spacing-100 pr-spacing-100",class:a?.isLink?"text-content-on-neutral-tertiary":"text-content-on-neutral-primary"},[t("p",[e._v(" "+e._s(a?.name)+" "),a?.isLink?e._e():t("span",{staticClass:"ml-spacing-50 rounded-04 bg-bg-status-success px-spacing-50 py-spacing-0 text-overline/s/relaxed/500 text-content-on-status-on-success"},[e._v(" NEW ")])])]),t("td",{staticClass:"py-spacing-100 pr-spacing-100"},[t("FileActions",{attrs:{file:a},on:{remove:function(t){return e.removeFile(s)}}})],1)])}))},proxy:!0}],null,!1,2277185041)}):e._e(),t("GeneralTextEditor",{staticClass:"mb-spacing-300",attrs:{value:e.formData.guidelines,label:"Guide Lines","editor-id":"guidelines"},on:{input:e.handleGuideLinesChange}}),t("GeneralTextEditor",{attrs:{value:e.formData.emailTemplate,label:"Email Template","editor-id":"emailTemplate"},on:{input:e.handleEmailTemplateChange}})]},proxy:!0}])})],1)}),[],!1,null,null,null),p=d.exports},49659:function(e,t,a){a.d(t,{Z:function(){return s}});const s={DEFAULT:{MAX_FILE_SIZE:10485760,ALLOWED_FILE_EXTENSIONS:[".pdf",".doc",".docx",".xlsx",".xls",".png",".jpeg",".jpg",".txt",".gif",".bmp",".ppt",".pptx"],UPLOAD_DIRECTORY:"/storage/uploads"},QUOTATION:{MAX_FILE_SIZE:5242880,ALLOWED_FILE_EXTENSIONS:[".pdf",".doc",".docx",".xlsx",".xls",".png",".jpeg",".jpg",".txt",".gif",".bmp",".ppt",".pptx"],UPLOAD_DIRECTORY:"/storage/documents/quotations"},MARKET_RESEARCH_FILES:{MAX_FILE_SIZE:5242880,ALLOWED_FILE_EXTENSIONS:[".pdf",".doc",".docx",".xlsx",".xls",".png",".jpeg",".jpg",".txt",".gif",".bmp",".ppt",".pptx"],UPLOAD_DIRECTORY:"/storage/documents/files"},IMAGE:{MAX_FILE_SIZE:2097152,ALLOWED_FILE_EXTENSIONS:[".jpg",".jpeg",".png"],UPLOAD_DIRECTORY:"/storage/images"},EXTENSIONS:{DOC:[".doc",".docx",".html",".htm",".odt",".pdf",".xls",".xlsx",".ods",".ppt",".pptx",".txt"],IMAGE:[".png",".jpeg",".jpg",".gif",".bmp"]}}}}]);